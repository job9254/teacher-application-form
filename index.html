<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>درخواست وظیفه معلم | لیسه عالی خصوصی شمع خانه نور</title>
<style>
/* استایل پایه */
body { 
    margin: 0; 
    font-family: "Segoe UI", Tahoma, sans-serif; 
    background-color: #eef2f7; 
    color: #2c3e50; 
    line-height: 1.6;
}

/* هدر */
.header { 
    background: linear-gradient(135deg, #0a3d8f, #1565c0); 
    color: #fff; 
    padding: 50px 20px 30px; 
    text-align: center; 
    border-bottom-left-radius: 20px; 
    border-bottom-right-radius: 20px; 
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.header h1 { 
    margin: 0; 
    font-size: 32px; 
    font-weight: bold; 
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
}

.header p { 
    margin-top: 8px; 
    font-size: 18px; 
    opacity: 0.95; 
}

.info-box { 
    max-width: 900px; 
    margin: 20px auto 0; 
    background-color: rgba(255, 255, 255, 0.15); 
    padding: 16px 18px; 
    border-radius: 12px; 
    font-size: 15px; 
    line-height: 1.8; 
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.info-box a { 
    color: #ffeb3b; 
    text-decoration: none; 
    font-weight: bold;
    transition: color 0.3s;
}

.info-box a:hover { 
    color: #fff; 
    text-decoration: underline;
}

/* کانتینر اصلی */
.container { 
    max-width: 900px; 
    margin: 30px auto 50px; 
    background: #fff; 
    padding: 30px; 
    border-radius: 15px; 
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    transition: transform 0.3s ease;
}

.container:hover {
    transform: translateY(-5px);
}

h3 { 
    margin-bottom: 18px; 
    color: #0a3d8f; 
    font-size: 24px; 
    border-bottom: 3px solid #1565c0; 
    padding-bottom: 6px; 
}

/* فرم */
label { 
    display: block; 
    margin-top: 14px; 
    font-weight: bold; 
    color: #2c3e50;
}

label:has(input:required)::after,
label:has(select:required)::after {
    content: " *";
    color: #d32f2f;
    font-size: 14px;
}

input:required, select:required {
    background-color: #f9f9ff;
    border-right: 3px solid #1565c0;
}

input, select, textarea { 
    width: 100%; 
    padding: 12px; 
    margin-top: 6px; 
    border: 1px solid #ddd; 
    border-radius: 10px; 
    font-size: 15px; 
    box-sizing: border-box; 
    transition: all 0.3s;
    font-family: inherit;
}

input:focus, textarea:focus, select:focus { 
    border-color: #1565c0; 
    box-shadow: 0 0 8px rgba(21, 101, 192, 0.3); 
    outline: none; 
    background-color: #fff;
}

fieldset { 
    border: 1px solid #ddd; 
    padding: 20px; 
    border-radius: 12px; 
    margin-top: 14px; 
    background-color: #f9fafc;
}

legend { 
    font-weight: bold; 
    color: #0a3d8f; 
    font-size: 16px; 
    padding: 0 10px;
}

/* چک باکس ها */
.checkbox-group label { 
    display: flex; 
    align-items: center; 
    padding: 10px 12px; 
    margin: 8px 0; 
    border-radius: 8px; 
    transition: all 0.2s;
    font-weight: normal;
    cursor: pointer;
    background-color: #fff;
    border: 1px solid #eee;
}

.checkbox-group label:hover { 
    background-color: #f0f7ff; 
    border-color: #1565c0;
}

.checkbox-group input[type="checkbox"] { 
    width: auto; 
    margin-left: 10px; 
    margin-right: 0; 
    cursor: pointer;
    width: 18px;
    height: 18px;
}

/* دکمه */
button { 
    margin-top: 25px; 
    padding: 14px 28px; 
    background-color: #1565c0; 
    color: #fff; 
    font-size: 16px; 
    border: none; 
    border-radius: 10px; 
    cursor: pointer; 
    transition: all 0.3s;
    font-weight: bold;
    position: relative;
    overflow: hidden;
    width: 100%;
    box-shadow: 0 4px 6px rgba(21, 101, 192, 0.2);
}

button:hover { 
    background-color: #0a3d8f; 
    box-shadow: 0 6px 12px rgba(21, 101, 192, 0.3);
    transform: translateY(-2px);
}

button:active { 
    transform: translateY(0); 
}

button::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.5);
    opacity: 0;
    border-radius: 100%;
    transform: scale(1, 1) translate(-50%);
    transform-origin: 50% 50%;
}

button:focus:not(:active)::after {
    animation: ripple 1s ease-out;
}

@keyframes ripple {
    0% {
        transform: scale(0, 0);
        opacity: 0.5;
    }
    100% {
        transform: scale(20, 20);
        opacity: 0;
    }
}

/* نتیجه */
#result { 
    margin-top: 20px; 
    font-weight: bold; 
    padding: 16px; 
    border-radius: 8px; 
    display: none; 
    text-align: center;
    font-size: 16px;
}

#result.success { 
    background-color: #d4edda; 
    color: #155724;
    border: 1px solid #c3e6cb;
}

#result.error { 
    background-color: #f8d7da; 
    color: #721c24;
    border: 1px solid #f5c6cb;
}

/* لودینگ */
#loading { 
    display: none; 
    text-align: center; 
    padding: 30px;
    background: #f8f9fa;
    border-radius: 10px;
    margin-top: 20px;
}

.loader {
    display: inline-block;
    width: 50px;
    height: 50px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #1565c0;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 15px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.error-message {
    color: #d32f2f;
    font-size: 13px;
    margin-top: 5px;
    font-weight: normal;
}

/* رسپانسیو */
@media (max-width: 600px) {
    .container {
        padding: 20px 15px;
        margin: 20px 15px 30px;
    }
    
    h3 {
        font-size: 20px;
    }
    
    .header h1 {
        font-size: 26px;
    }
    
    .header p {
        font-size: 16px;
    }
    
    .header {
        padding: 30px 15px 20px;
    }
    
    .checkbox-group label {
        padding: 12px;
        margin: 10px 0;
    }
    
    fieldset {
        padding: 15px;
    }
    
    input, select, textarea {
        font-size: 16px;
        padding: 14px;
    }
    
    button {
        padding: 16px;
        font-size: 17px;
    }
}

/* انیمیشن برای ظاهر شدن فرم */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.container {
    animation: fadeIn 0.5s ease-out;
}

/* استایل برای وضعیت غیرفعال */
.disabled-input {
    background-color: #f5f5f5;
    cursor: not-allowed;
    opacity: 0.7;
}
</style>
</head>
<body>

<div class="header">
<h1>لیسه عالی خصوصی شمع خانه نور</h1>
<p>فرم رسمی درخواست وظیفه معلم</p>
<div class="info-box">
لطفاً تمامی فیلدها را پر کرده و CV خود را به <a href="mailto:shamekhanaenoor@gmail.com">shamekhanaenoor@gmail.com</a> و به شماره واتس‌اپ 0798535340 ارسال کنید.
</div>
</div>

<div class="container">
<form id="teacherForm">

<h3>معلومات شخصی و تحصیلی</h3>
<label>نام</label>
<input type="text" name="نام" required placeholder="نام خود را وارد کنید">
<label>نام خانوادگی</label>
<input type="text" name="نام خانوادگی" required placeholder="نام خانوادگی خود را وارد کنید">
<label>نام پدر</label>
<input type="text" name="نام پدر" placeholder="نام پدر خود را وارد کنید">
<label>آدرس</label>
<textarea name="آدرس" rows="2" placeholder="آدرس کامل محل سکونت"></textarea>
<label>ملیت</label>
<input type="text" name="ملیت" placeholder="ملیت خود را وارد کنید">
<label>حالت مدنی</label>
<select name="حالت مدنی">
<option value="">انتخاب کنید</option>
<option>مجرد</option>
<option>متأهل</option>
<option>دیگر</option>
</select>
<label>شماره تذکره</label>
<input type="text" name="شماره تذکره" placeholder="شماره تذکره را وارد کنید">
<label>شماره تلفن</label>
<input type="tel" name="شماره تلفن" required placeholder="مثال: 0798535340">
<label>ایمیل آدرس</label>
<input type="email" name="ایمیل آدرس" placeholder="example@gmail.com">

<h3>سابقه کاری</h3>
<label>چند سال سابقه کاری دارید؟</label>
<input type="number" name="سال_سابقه_کاری" min="0" max="50" placeholder="مثلاً 5">

<fieldset>
<legend>در کدام بخش‌ها کار کرده‌اید؟</legend>
<div id="experienceSections" class="checkbox-group">
<!-- چک‌باکس بخش‌ها از Sheet اضافه خواهد شد -->
</div>
</fieldset>

<h3>لیست وظایف</h3>
<fieldset>
<legend>انتخاب وظایف (حداقل یک مورد)</legend>
<div id="tasksSelect" class="checkbox-group">
<!-- چک‌باکس وظایف از Sheet اضافه خواهد شد -->
</div>
</fieldset>

<label>مرجع (اختیاری)</label>
<input type="text" name="مرجع" placeholder="در صورت داشتن مرجع، نام آن را بنویسید">

<button type="submit">ارسال درخواست</button>
</form>

<div id="loading">
<div class="loader"></div>
<p>در حال ارسال اطلاعات...</p>
</div>

<p id="result"></p>
</div>

<script>
// عناصر DOM
const form = document.getElementById("teacherForm");
const result = document.getElementById("result");
const tasksContainer = document.getElementById("tasksSelect");
const experienceContainer = document.getElementById("experienceSections");
const loading = document.getElementById("loading");

// URL Web App شما
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwbpR3jHaNkdQfB5E08jfO8RVdofGmNGpbAE_0P_ArizbFk7xFFu8ZrC7A3aXPsdorNiw/exec";

// اعتبارسنجی ایمیل
function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
}

// اعتبارسنجی شماره تلفن افغانستان
function validatePhone(phone) {
    const phoneRegex = /^(\+93|0)?[7][0-9]{8}$/;
    return phoneRegex.test(phone);
}

// نمایش خطا
function showError(input, message) {
    // حذف خطاهای قبلی
    const existingError = input.parentNode.querySelector('.error-message');
    if (existingError) {
        existingError.remove();
    }
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    
    input.parentNode.appendChild(errorDiv);
    input.style.borderColor = '#d32f2f';
    
    setTimeout(() => {
        if (errorDiv.parentNode) {
            errorDiv.remove();
        }
        input.style.borderColor = '#ddd';
    }, 5000);
}

// اعتبارسنجی فرم
function validateForm() {
    let isValid = true;
    
    // اعتبارسنجی شماره تلفن
    const phoneInput = form.querySelector('input[name="شماره تلفن"]');
    if (phoneInput.value && !validatePhone(phoneInput.value)) {
        showError(phoneInput, "شماره تلفن معتبر نیست. فرمت صحیح: 0791234567");
        isValid = false;
    }
    
    // اعتبارسنجی ایمیل
    const emailInput = form.querySelector('input[name="ایمیل آدرس"]');
    if (emailInput.value && !validateEmail(emailInput.value)) {
        showError(emailInput, "ایمیل معتبر نیست");
        isValid = false;
    }
    
    // اعتبارسنجی وظایف انتخاب شده
    const selectedTasks = Array.from(form.querySelectorAll('input[name="وظایف انتخاب شده"]:checked')).map(c => c.value);
    if (selectedTasks.length === 0) {
        result.innerText = "لطفاً حداقل یک وظیفه انتخاب کنید ❌";
        result.className = "error"; 
        result.style.display = "block";
        isValid = false;
        
        // اسکرول به بخش وظایف
        tasksContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    return isValid;
}

// دریافت وظایف و بخش‌های سابقه کاری از Google Sheets
fetch(WEB_APP_URL)
.then(res => res.json())
.then(data => {
    console.log("داده‌های دریافتی:", data);
    
    if (data.status && data.status === "error") {
        throw new Error(data.message);
    }

    // اضافه کردن وظایف
    if (data.tasks && data.tasks.length > 0) {
        data.tasks.forEach(task => {
            const label = document.createElement("label");
            label.innerHTML = `<input type="checkbox" name="وظایف انتخاب شده" value="${task}"> ${task}`;
            tasksContainer.appendChild(label);
        });
    } else {
        tasksContainer.innerHTML = '<p style="color:#666; text-align:center;">در حال بارگذاری وظایف...</p>';
    }

    // اضافه کردن بخش‌های سابقه کاری
    if (data.experienceSections && data.experienceSections.length > 0) {
        data.experienceSections.forEach(sec => {
            const label = document.createElement("label");
            label.innerHTML = `<input type="checkbox" name="بخش‌های_سابقه" value="${sec}"> ${sec}`;
            experienceContainer.appendChild(label);
        });
    } else {
        experienceContainer.innerHTML = '<p style="color:#666; text-align:center;">در حال بارگذاری بخش‌ها...</p>';
    }
})
.catch(err => {
    console.error("خطا در دریافت داده‌ها:", err);
    result.innerText = "خطا در اتصال به سرور. لطفاً صفحه را رفرش کنید.";
    result.className = "error";
    result.style.display = "block";
    
    // نمایش گزینه‌های پیش‌فرض در صورت خطا
    const defaultTasks = ['معلم ریاضی', 'معلم فیزیک', 'معلم کیمیا', 'معلم بیولوژی', 'معلم زبان انگلیسی', 'معلم علوم اجتماعی'];
    const defaultSections = ['لیسه', 'مکتب', 'پوهنتون', 'مرکز آموزشی خصوصی'];
    
    defaultTasks.forEach(task => {
        const label = document.createElement("label");
        label.innerHTML = `<input type="checkbox" name="وظایف انتخاب شده" value="${task}"> ${task}`;
        tasksContainer.appendChild(label);
    });
    
    defaultSections.forEach(sec => {
        const label = document.createElement("label");
        label.innerHTML = `<input type="checkbox" name="بخش‌های_سابقه" value="${sec}"> ${sec}`;
        experienceContainer.appendChild(label);
    });
});

// ارسال فرم
form.addEventListener("submit", function(e) {
    e.preventDefault();
    
    // اعتبارسنجی
    if (!validateForm()) {
        return;
    }
    
    // جمع‌آوری داده‌ها
    const selectedTasks = Array.from(form.querySelectorAll('input[name="وظایف انتخاب شده"]:checked')).map(c => c.value);
    const selectedSections = Array.from(form.querySelectorAll('input[name="بخش‌های_سابقه"]:checked')).map(c => c.value);

    const data = {};
    const inputs = form.querySelectorAll("input[type=text], input[type=tel], input[type=email], input[type=number], textarea, select");
    
    inputs.forEach(el => {
        data[el.name] = el.value;
    });

    data["وظایف انتخاب شده"] = selectedTasks.join(", ");
    data["بخش‌های_سابقه"] = selectedSections.join(", ");
    
    // افزودن timestamp
    data["زمان ارسال"] = new Date().toLocaleString('fa-IR');

    // نمایش لودینگ
    loading.style.display = "block";
    result.style.display = "none";
    
    // غیرفعال کردن دکمه
    const submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = "در حال ارسال...";
    submitBtn.classList.add("disabled-input");

    // ارسال داده‌ها
    fetch(WEB_APP_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(response => {
        loading.style.display = "none";
        submitBtn.disabled = false;
        submitBtn.innerHTML = "ارسال درخواست";
        submitBtn.classList.remove("disabled-input");
        
        if (response.status === "success") {
            result.innerHTML = `
                <div style="font-size: 18px; margin-bottom: 10px;">✅ درخواست شما با موفقیت ثبت شد</div>
                <div style="background: white; padding: 10px; border-radius: 8px; margin: 10px 0;">
                    <strong>کد رهگیری:</strong> ${response.trackingCode}
                </div>
                <p style="font-size: 14px; margin-top: 10px;">
                    لطفاً کد رهگیری را یادداشت کنید. به زودی با شما تماس گرفته خواهد شد.
                </p>
            `;
            result.className = "success"; 
            result.style.display = "block";
            
            // پاک کردن فرم
            form.reset();
            
            // اسکرول به نتیجه
            result.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // پاک کردن انتخاب چک‌باکس‌ها
            form.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
        } else {
            result.innerText = "خطا در ثبت اطلاعات. لطفاً دوباره تلاش کنید ❌";
            result.className = "error"; 
            result.style.display = "block";
        }
    })
    .catch(err => {
        console.error("خطا در ارسال فرم:", err);
        loading.style.display = "none";
        submitBtn.disabled = false;
        submitBtn.innerHTML = "ارسال درخواست";
        submitBtn.classList.remove("disabled-input");
        
        result.innerHTML = `
            <div style="font-size: 18px; margin-bottom: 10px;">❌ مشکل ارتباط با سرور</div>
            <p style="font-size: 14px;">
                امکان برقراری ارتباط با سرور وجود ندارد. لطفاً:
                <br>1. اتصال اینترنت خود را بررسی کنید
                <br>2. دوباره تلاش کنید
                <br>3. با پشتیبانی تماس بگیرید
            </p>
        `;
        result.className = "error";
        result.style.display = "block";
    });
});

// اعتبارسنجی بلادرنگ برای شماره تلفن
const phoneInput = form.querySelector('input[name="شماره تلفن"]');
phoneInput.addEventListener('blur', function() {
    if (this.value && !validatePhone(this.value)) {
        showError(this, "شماره تلفن معتبر نیست. فرمت صحیح: 0791234567");
    }
});

// اعتبارسنجی بلادرنگ برای ایمیل
const emailInput = form.querySelector('input[name="ایمیل آدرس"]');
emailInput.addEventListener('blur', function() {
    if (this.value && !validateEmail(this.value)) {
        showError(this, "ایمیل معتبر نیست");
    }
});
</script>

</body>
</html>